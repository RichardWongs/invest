# encoding: utf-8
from parse import *
import logging


def extract_dividend_detail(s: str):
    sendCount = 0
    turnCount = 0
    cash = 0
    if "送" in s:
        profile = search("送{send:f}", s)
        sendCount = profile["send"]
    if "转" in s:
        profile = search("转{turn:f}", s)
        turnCount = profile["turn"]
    if "派" in s:
        profile = search("派{dividend:f}", s)
        cash = profile["dividend"]
    logging.warning(f"送股:{sendCount}\t转股:{turnCount}\t派息:{cash}")
    return {'sendCount': sendCount, 'turnCount': turnCount, 'cash': cash}


s = {'002641': {2016: [{'SECURITY_CODE': '002641', 'SECURITY_NAME_ABBR': '永高股份', 'TRADE_MARKET_CODE': '069001002001', 'TRADE_MARKET': '深交所主板', 'SECURITY_TYPE_CODE': '058001001', 'SECURITY_TYPE': 'A股', 'UPDATE_DATE': '2018-04-21 00:00:00', 'REPORTDATE': '2016-12-31 00:00:00', 'BASIC_EPS': 0.19, 'DEDUCT_BASIC_EPS': 0.22, 'TOTAL_OPERATE_INCOME': 3767378127.54, 'PARENT_NETPROFIT': 214847407.47, 'WEIGHTAVG_ROE': 8.76, 'YSTZ': 6.6205913753, 'SJLTZ': -17.1790398353, 'BPS': 2.940738008738, 'MGJYXJJE': 0.635850816123, 'XSMLL': 27.5428792585, 'YSHZ': 20.202, 'SJLHZ': -101.2661, 'ASSIGNDSCRPT': '10送2.00转1.00派0.50元(含税,扣税后0.25元)', 'PAYYEAR': '2016', 'PUBLISHNAME': '水泥建材', 'ZXGXL': 0.706214689266, 'NOTICE_DATE': '2017-04-22 00:00:00', 'ORG_CODE': '10177194', 'TRADE_MARKET_ZJG': '0201', 'ISNEW': '0', 'QDATE': '2016Q4', 'DATATYPE': '2016年 年报', 'DATAYEAR': '2016', 'DATEMMDD': '年报', 'EITIME': '2019-04-29 11:12:57', 'SECUCODE': '002641.SZ'}], 2017: [{'SECURITY_CODE': '002641', 'SECURITY_NAME_ABBR': '永高股份', 'TRADE_MARKET_CODE': '069001002001', 'TRADE_MARKET': '深交所主板', 'SECURITY_TYPE_CODE': '058001001', 'SECURITY_TYPE': 'A股', 'UPDATE_DATE': '2019-04-25 00:00:00', 'REPORTDATE': '2017-12-31 00:00:00', 'BASIC_EPS': 0.17, 'DEDUCT_BASIC_EPS': 0.14, 'TOTAL_OPERATE_INCOME': 4569721119.35, 'PARENT_NETPROFIT': 192654302.75, 'WEIGHTAVG_ROE': 7.37, 'YSTZ': 21.2971187029, 'SJLTZ': -10.3297056182, 'BPS': 2.395167327546, 'MGJYXJJE': 0.184796587242, 'XSMLL': 22.9623767054, 'YSHZ': 7.8434, 'SJLHZ': -6.1981, 'ASSIGNDSCRPT': '10派0.26元(含税,扣税后0.234元)', 'PAYYEAR': '2017', 'PUBLISHNAME': '水泥建材', 'ZXGXL': 0.760233918129, 'NOTICE_DATE': '2018-04-21 00:00:00', 'ORG_CODE': '10177194', 'TRADE_MARKET_ZJG': '0201', 'ISNEW': '0', 'QDATE': '2017Q4', 'DATATYPE': '2017年 年报', 'DATAYEAR': '2017', 'DATEMMDD': '年报', 'EITIME': '2019-04-29 11:13:45', 'SECUCODE': '002641.SZ'}], 2018: [{'SECURITY_CODE': '002641', 'SECURITY_NAME_ABBR': '永高股份', 'TRADE_MARKET_CODE': '069001002001', 'TRADE_MARKET': '深交所主板', 'SECURITY_TYPE_CODE': '058001001', 'SECURITY_TYPE': 'A股', 'UPDATE_DATE': '2020-04-28 00:00:00', 'REPORTDATE': '2018-12-31 00:00:00', 'BASIC_EPS': 0.22, 'DEDUCT_BASIC_EPS': 0.21, 'TOTAL_OPERATE_INCOME': 5353776518.03, 'PARENT_NETPROFIT': 244670411.43, 'WEIGHTAVG_ROE': 8.74, 'YSTZ': 17.1576203055, 'SJLTZ': 26.9997129249, 'BPS': 2.589526708431, 'MGJYXJJE': 0.371293528543, 'XSMLL': 23.5929961465, 'YSHZ': 17.087, 'SJLHZ': 3.8459, 'ASSIGNDSCRPT': '10派0.33元(含税,扣税后0.297元)', 'PAYYEAR': '2018', 'PUBLISHNAME': '水泥建材', 'ZXGXL': 0.776470588235, 'NOTICE_DATE': '2019-04-25 00:00:00', 'ORG_CODE': '10177194', 'TRADE_MARKET_ZJG': '0201', 'ISNEW': '0', 'QDATE': '2018Q4', 'DATATYPE': '2018年 年报', 'DATAYEAR': '2018', 'DATEMMDD': '年报', 'EITIME': '2019-04-29 11:14:53', 'SECUCODE': '002641.SZ'}], 2019: [{'SECURITY_CODE': '002641', 'SECURITY_NAME_ABBR': '永高股份', 'TRADE_MARKET_CODE': '069001002001', 'TRADE_MARKET': '深交所主板', 'SECURITY_TYPE_CODE': '058001001', 'SECURITY_TYPE': 'A股', 'UPDATE_DATE': '2021-04-27 00:00:00', 'REPORTDATE': '2019-12-31 00:00:00', 'BASIC_EPS': 0.46, 'DEDUCT_BASIC_EPS': 0.42, 'TOTAL_OPERATE_INCOME': 6290606343.7, 'PARENT_NETPROFIT': 513720532.02, 'WEIGHTAVG_ROE': 16.36, 'YSTZ': 17.4984858355, 'SJLTZ': 109.96, 'BPS': 3.011459175027, 'MGJYXJJE': 0.765034762918, 'XSMLL': 25.757942609, 'YSHZ': 17.6691, 'SJLHZ': 43.817, 'ASSIGNDSCRPT': '10派1.38元(含税,扣税后1.242元)', 'PAYYEAR': '2019', 'PUBLISHNAME': '水泥建材', 'ZXGXL': 1.785252263907, 'NOTICE_DATE': '2020-04-28 00:00:00', 'ORG_CODE': '10177194', 'TRADE_MARKET_ZJG': '0201', 'ISNEW': '0', 'QDATE': '2019Q4', 'DATATYPE': '2019年 年报', 'DATAYEAR': '2019', 'DATEMMDD': '年报', 'EITIME': '2020-04-27 23:20:51', 'SECUCODE': '002641.SZ'}], 2020: [{'SECURITY_CODE': '002641', 'SECURITY_NAME_ABBR': '永高股份', 'TRADE_MARKET_CODE': '069001002001', 'TRADE_MARKET': '深交所主板', 'SECURITY_TYPE_CODE': '058001001', 'SECURITY_TYPE': 'A股', 'UPDATE_DATE': '2021-04-27 00:00:00', 'REPORTDATE': '2020-12-31 00:00:00', 'BASIC_EPS': 0.68, 'DEDUCT_BASIC_EPS': 0.63, 'TOTAL_OPERATE_INCOME': 7036300477.8, 'PARENT_NETPROFIT': 769606258.94, 'WEIGHTAVG_ROE': 20.67, 'YSTZ': 11.8540899455, 'SJLTZ': 49.81, 'BPS': 3.804873487914, 'MGJYXJJE': 0.862674417338, 'XSMLL': 25.5853368737, 'YSHZ': 17.0064, 'SJLHZ': -11.4832, 'ASSIGNDSCRPT': '10派1.25元(含税,扣税后1.125元)', 'PAYYEAR': '2020', 'PUBLISHNAME': '水泥建材', 'ZXGXL': 1.846381093058, 'NOTICE_DATE': '2021-04-27 00:00:00', 'ORG_CODE': '10177194', 'TRADE_MARKET_ZJG': '0201', 'ISNEW': '0', 'QDATE': '2020Q4', 'DATATYPE': '2020年 年报', 'DATAYEAR': '2020', 'DATEMMDD': '年报', 'EITIME': '2021-04-26 22:57:49', 'SECUCODE': '002641.SZ'}]}}
r = {}
for _, v in s.items():
    for _, l in v.items():
        for i in l:
            data = extract_dividend_detail(i['ASSIGNDSCRPT'])
            report_date = i["REPORTDATE"].replace(" 00:00:00", "").replace("-", "")
            r[report_date] = data
print(r)
print(sorted(r, key=r.keys(), reverse=False))

stockCount = 10 * (1+(2.0+1.0)/10) * (1+(0+0)/10)






